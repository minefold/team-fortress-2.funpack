#!/usr/bin/env bash

# this runs once per machine. We use it to download TF2
# the cache-dir is for temporary storage
# the build-dir will be made available to the run command

# ## Usage
#
#     $ bin/bootstrap <build-dir> <cache-dir>

set -ex

BIN_DIR=$(cd $(dirname $0); pwd) # absolute path
ROOT_DIR=$(dirname $BIN_DIR)
BUILD_DIR=$(cd $1; pwd)
CACHE_DIR=$(cd $2; pwd)

mkdir -p $CACHE_DIR

cd $CACHE_DIR
if [ ! -f hldsupdatetool.bin ]
then
    wget http://storefront.steampowered.com/download/hldsupdatetool.bin
    chmod +x hldsupdatetool.bin
fi

echo "yes" | ./hldsupdatetool.bin
./steam
./steam -command update -game tf -dir .
./steam -command update -game tf -dir .

rm -rf $BUILD_DIR/*
cp -R . $BUILD_DIR